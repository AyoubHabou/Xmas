    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>A Christmas Surprise üéÑ</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                font-family: 'Georgia', serif;
                background: linear-gradient(135deg, #0f1419 0%, #1a0d0d 50%, #0f1419 100%);
                overflow: hidden;
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                touch-action: none;
            }

            .snowflakes {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1;
            }

            .snowflake {
                position: absolute;
                top: -10px;
                color: rgba(255, 255, 255, 0.6);
                font-size: 1em;
                animation: fall linear infinite;
            }

            @keyframes fall {
                to {
                    transform: translateY(100vh) rotate(360deg);
                }
            }

            .container {
                position: relative;
                z-index: 10;
                text-align: center;
                width: 100%;
                height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .instruction-text {
                color: #fff;
                font-size: 1.6em;
                margin-bottom: 60px;
                text-shadow: 0 2px 20px rgba(0,0,0,0.8);
                animation: fadeIn 2s ease-in;
                line-height: 1.8;
                padding: 0 20px;
            }

            .emoji {
                display: inline-block;
                animation: twinkle 2s ease-in-out infinite;
            }

            @keyframes twinkle {
                0%, 100% { opacity: 1; transform: scale(1); }
                50% { opacity: 0.7; transform: scale(1.15); }
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-20px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .scene-3d {
    position: relative;
    width: 400px;
    height: 450px;
    perspective: 1200px;
    transform-style: preserve-3d;
    display: none;
    opacity: 0;
    transition: opacity 1s ease;
}

.scene-3d.visible {
    display: block;
    opacity: 1;
}
            /* ESCAPE ROOM STYLES */
.escape-room {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    background: rgba(15, 20, 25, 0.98);
    transition: opacity 1s ease, visibility 1s ease;
    padding: 20px;
    overflow-y: auto;
}

.escape-room.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}

.map-container {
    position: relative;
    width: 90vw;
    max-width: 800px;
    height: 60vh;
    min-height: 400px;
    background: linear-gradient(180deg, #1a2332 0%, #2d3f5f 100%);
    border-radius: 20px;
    border: 3px solid #FFD700;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    overflow: hidden;
}

.snow-path {
    position: absolute;
    background: linear-gradient(90deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.3) 100%);
    box-shadow: 0 0 20px rgba(255,255,255,0.3);
}

.path-horizontal {
    height: 60px;
    left: 10%;
    width: 80%;
}

.path-vertical {
    width: 60px;
    height: 35%;
}

.checkpoint {
    position: absolute;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5em;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.checkpoint:hover {
    transform: scale(1.1);
}

.checkpoint.locked {
    background: linear-gradient(135deg, #555 0%, #333 100%);
    border: 3px solid #888;
    cursor: not-allowed;
}

.checkpoint.unlocked {
    background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
    border: 3px solid #FFD700;
    animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255,215,0,0.5); }
    50% { box-shadow: 0 0 40px rgba(255,215,0,0.9); }
}

.checkpoint.completed {
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    border: 3px solid #4CAF50;
    pointer-events: none;
}

.start-point {
    top: 10%;
    left: 10%;
    background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
    border: 3px solid #2196F3;
}

.gift-endpoint {
    bottom: 10%;
    right: 10%;
    background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
    border: 3px solid #FFD700;
    font-size: 3em;
}

.gift-endpoint.unlocked {
    animation: giftBounce 1s ease-in-out infinite;
    cursor: pointer;
}

@keyframes giftBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.puzzle-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 90vw;
    max-width: 500px;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 20px;
    border: 3px solid #FFD700;
    padding: 30px;
    box-shadow: 0 20px 80px rgba(0,0,0,0.9);
    z-index: 2000;
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.puzzle-modal.active {
    transform: translate(-50%, -50%) scale(1);
}

.puzzle-title {
    color: #FFD700;
    font-size: 1.8em;
    margin-bottom: 20px;
    text-align: center;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

.puzzle-content {
    color: #fff;
    font-size: 1.2em;
    margin-bottom: 25px;
    text-align: center;
    line-height: 1.6;
}

.puzzle-input {
    width: 100%;
    padding: 15px;
    font-size: 1.2em;
    border: 2px solid #FFD700;
    border-radius: 10px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    text-align: center;
    margin-bottom: 20px;
    outline: none;
}

.puzzle-input::placeholder {
    color: rgba(255,255,255,0.5);
}

.puzzle-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.puzzle-btn {
    padding: 12px 30px;
    font-size: 1.1em;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
}

.submit-btn {
    background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
    color: white;
}

.submit-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(76,175,80,0.5);
}

.close-btn {
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    color: white;
}

.close-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(244,67,54,0.5);
}

.feedback-message {
    text-align: center;
    margin-top: 15px;
    font-size: 1.1em;
    min-height: 25px;
}

.feedback-message.correct {
    color: #4CAF50;
    animation: fadeIn 0.5s ease;
}

.feedback-message.incorrect {
    color: #f44336;
    animation: shake 0.5s ease;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.progress-bar {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.5);
    padding: 15px 30px;
    border-radius: 50px;
    border: 2px solid #FFD700;
    color: #FFD700;
    font-size: 1.2em;
    font-weight: bold;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
}

.decorative-tree {
    position: absolute;
    font-size: 3em;
    filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
    pointer-events: none;
}

.hint-text {
    color: rgba(255,215,0,0.8);
    font-size: 0.95em;
    text-align: center;
    margin-bottom: 15px;
    font-style: italic;
}

            .gift-wrapper {
                position: absolute;
                width: 100%;
                height: 100%;
                transform-style: preserve-3d;
                transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            .gift-wrapper.opened {
                transform: translateY(-150px) scale(0.8);
            }

            /* Gift Box Base */
            .gift-box-base {
                position: absolute;
                width: 280px;
                height: 280px;
                left: 50%;
                bottom: 50px;
                transform: translateX(-50%);
                background: linear-gradient(145deg, #8B0000 0%, #A52A2A 50%, #8B0000 100%);
                border-radius: 8px;
                box-shadow: 0 30px 80px rgba(0,0,0,0.7),
                            inset 0 -8px 30px rgba(0,0,0,0.4),
                            inset 0 8px 30px rgba(255,255,255,0.15);
                transform-style: preserve-3d;
            }

            .gift-box-base::before {
                content: '';
                position: absolute;
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
                border: 2px solid rgba(255, 215, 0, 0.2);
                border-radius: 5px;
            }

            /* Gift Lid */
            .gift-lid {
                position: absolute;
                width: 300px;
                height: 80px;
                left: 50%;
                bottom: 330px;
                transform: translateX(-50%);
                transform-style: preserve-3d;
                transform-origin: bottom center;
                transition: all 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                z-index: 10;
            }

            .gift-lid-top {
                position: absolute;
                width: 100%;
                height: 100%;
                background: linear-gradient(145deg, #A52A2A 0%, #8B0000 50%, #A52A2A 100%);
                border-radius: 8px;
                box-shadow: 0 20px 50px rgba(0,0,0,0.6),
                            inset 0 -5px 15px rgba(0,0,0,0.3),
                            inset 0 5px 15px rgba(255,255,255,0.2);
            }

            .gift-wrapper.opened .gift-lid {
                transform: translateX(-50%) rotateX(-135deg) translateZ(20px);
                opacity: 0;
            }

            /* Ribbons */
            .ribbon-vertical {
                position: absolute;
                width: 50px;
                height: 360px;
                left: 50%;
                bottom: 50px;
                transform: translateX(-50%);
                background: linear-gradient(90deg, #B8860B 0%, #FFD700 30%, #FFED4E 50%, #FFD700 70%, #B8860B 100%);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6),
                            inset 0 0 15px rgba(0,0,0,0.2),
                            inset 3px 0 8px rgba(255,255,255,0.3);
                z-index: 5;
                transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            .ribbon-horizontal {
                position: absolute;
                width: 280px;
                height: 50px;
                bottom: 190px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(180deg, #B8860B 0%, #FFD700 30%, #FFED4E 50%, #FFD700 70%, #B8860B 100%);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.6),
                            inset 0 0 15px rgba(0,0,0,0.2),
                            inset 0 3px 8px rgba(255,255,255,0.3);
                z-index: 4;
                transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            /* Bow */
            .bow {
                position: absolute;
                top: -20px;
                left: 50%;
                transform: translateX(-50%);
                width: 140px;
                height: 100px;
                cursor: grab;
                touch-action: none;
                z-index: 20;
                filter: drop-shadow(0 10px 25px rgba(0,0,0,0.5));
                transition: transform 0.2s ease;
            }

            .bow:active {
                cursor: grabbing;
            }

            .bow-loop {
                position: absolute;
                width: 60px;
                height: 70px;
                background: linear-gradient(145deg, #FFED4E 0%, #FFD700 50%, #B8860B 100%);
                border-radius: 50% 50% 50% 0;
                box-shadow: 0 8px 20px rgba(0,0,0,0.4),
                            inset -3px -3px 8px rgba(0,0,0,0.3),
                            inset 3px 3px 8px rgba(255,255,255,0.4);
            }

            .bow-loop-left {
                left: 0;
                transform: rotate(-45deg);
            }

            .bow-loop-right {
                right: 0;
                transform: rotate(135deg);
            }

            .bow-center {
                position: absolute;
                width: 40px;
                height: 40px;
                background: linear-gradient(145deg, #FFED4E, #FFD700);
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                box-shadow: 0 5px 15px rgba(0,0,0,0.5),
                            inset 0 3px 6px rgba(255,255,255,0.4);
                z-index: 1;
            }

            .bow-tails {
                position: absolute;
                top: 70px;
                left: 50%;
                transform: translateX(-50%);
                width: 100px;
            }

            .bow-tail {
                position: absolute;
                width: 25px;
                height: 60px;
                background: linear-gradient(180deg, #FFD700, #B8860B);
                clip-path: polygon(50% 0%, 0% 0%, 25% 100%);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }

            .bow-tail-left {
                left: 15px;
                transform: rotate(-15deg);
            }

            .bow-tail-right {
                right: 15px;
                transform: rotate(15deg);
            }

            .gift-wrapper.opened .ribbon-vertical,
            .gift-wrapper.opened .ribbon-horizontal,
            .gift-wrapper.opened .bow {
                opacity: 0;
                transform: translateY(200px) rotate(180deg) scale(0.5);
            }

            /* Gift Content Inside */
            .gift-content {
                position: absolute;
                width: 260px;
                height: 260px;
                left: 50%;
                bottom: 60px;
                transform: translateX(-50%) translateY(20px) scale(0.7);
                opacity: 0;
                transition: all 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                pointer-events: none;
            }

            .gift-wrapper.opened .gift-content {
                transform: translateX(-50%) translateY(0) scale(1);
                opacity: 1;
                transition-delay: 1s;
            }

            .gift-card {
                background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
                border-radius: 0px;
                padding: 10px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.4),
                            inset 0 1px 0 rgba(255,255,255,0.5);
                text-align: center;
                border: 3px solid #DAA520;
                position: relative;
                overflow: hidden;
            }

            .gift-card::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: linear-gradient(45deg, transparent 30%, rgba(255,215,0,0.1) 50%, transparent 70%);
                animation: shimmer 3s infinite;
            }

            @keyframes shimmer {
                0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
                100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            }

            .spa-logo {
                font-size: 2.8em;
                font-weight: bold;
                background: linear-gradient(135deg, #2C5F2D 0%, #97BC62 50%, #2C5F2D 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                letter-spacing: 8px;
                margin-bottom: 15px;
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }

            .spa-tagline {
                font-size: 1em;
                color: #2C5F2D;
                font-style: italic;
                margin-bottom: 20px;
                letter-spacing: 2px;
            }

            .spa-icon {
                font-size: 3em;
                margin: 15px 0;
                filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            }

            .location-text {
                font-size: 1.1em;
                color: #555;
                margin-top: 15px;
                font-weight: 500;
            }

            .christmas-message {
                margin-top: 20px;
                font-size: 1.3em;
                color: #8B0000;
                font-weight: bold;
            }

            /* Particles */
            .particle {
                position: absolute;
                width: 10px;
                height: 10px;
                background: radial-gradient(circle, #FFD700, transparent);
                border-radius: 50%;
                pointer-events: none;
                animation: particle-float 2s ease-out forwards;
                opacity: 0;
            }

            @keyframes particle-float {
                0% {
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translateY(-200px) scale(0);
                    opacity: 0;
                }
            }

            .drag-hint {
                position: absolute;
                bottom: -80px;
                left: 50%;
                transform: translateX(-50%);
                color: rgba(255, 215, 0, 0.9);
                font-size: 1.2em;
                animation: bounce 2s ease-in-out infinite;
                text-shadow: 0 2px 10px rgba(0,0,0,0.8);
                font-weight: 500;
            }

            @keyframes bounce {
                0%, 100% { transform: translateX(-50%) translateY(0); }
                50% { transform: translateX(-50%) translateY(-15px); }
            }

            .gift-wrapper.opened .drag-hint {
                opacity: 0;
            }

            /* Bokeh */
            .bokeh {
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                pointer-events: none;
                z-index: 2;
            }

            .bokeh-light {
                position: absolute;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(255,215,0,0.3) 0%, transparent 70%);
                animation: float 6s ease-in-out infinite;
            }

            @keyframes float {
                0%, 100% { transform: translateY(0) translateX(0); }
                50% { transform: translateY(-30px) translateX(20px); }
            }

            .final-message {
                position: fixed;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);
                color: rgba(255, 255, 255, 0);
                font-size: 1.4em;
                text-align: center;
                transition: color 1s ease;
                text-shadow: 0 2px 20px rgba(0,0,0,0.8);
                z-index: 100;
            }

            .gift-wrapper.opened ~ .final-message {
                color: rgba(255, 255, 255, 1);
                transition-delay: 2s;
            }
        </style>
    </head>
    <body>
        <div class="snowflakes" id="snowflakes"></div>
        <div class="bokeh" id="bokeh"></div>

        <div class="container">
            <!-- ESCAPE ROOM -->
<div class="escape-room" id="escapeRoom">
    <div class="progress-bar" id="progressBar">Puzzles Solved: 0/4</div>
    
    <div class="map-container">
        <!-- Decorative trees -->
        <div class="decorative-tree" style="top: 5%; left: 5%;">üå≤</div>
        <div class="decorative-tree" style="top: 15%; right: 15%;">üå≤</div>
        <div class="decorative-tree" style="bottom: 20%; left: 20%;">üå≤</div>
        <div class="decorative-tree" style="bottom: 5%; right: 5%;">üéÑ</div>
        
        <!-- Snow paths -->
        <div class="snow-path path-horizontal" style="top: 15%;"></div>
        <div class="snow-path path-vertical" style="top: 15%; left: 75%; height: 30%;"></div>
        <div class="snow-path path-horizontal" style="top: 45%;"></div>
        <div class="snow-path path-vertical" style="top: 45%; left: 25%; height: 30%;"></div>
        <div class="snow-path path-horizontal" style="top: 75%;"></div>
        
        <!-- Start point -->
        <div class="checkpoint start-point">üë§</div>
        
        <!-- Checkpoint 1 - Charlie the Dog -->
        <div class="checkpoint unlocked" id="checkpoint1" data-puzzle="1" style="top: 12%; right: 12%;">
            üîí
        </div>
        
        <!-- Checkpoint 2 - Darija -->
        <div class="checkpoint locked" id="checkpoint2" data-puzzle="2" style="top: 42%; left: 12%;">
            üîí
        </div>
        
        <!-- Checkpoint 3 - Math -->
        <div class="checkpoint locked" id="checkpoint3" data-puzzle="3" style="top: 72%; left: 25%;">
            üîí
        </div>
        
        <!-- Checkpoint 4 - Funny -->
        <div class="checkpoint locked" id="checkpoint4" data-puzzle="4" style="top: 72%; right: 30%;">
            üîí
        </div>
        
        <!-- Gift endpoint -->
        <div class="checkpoint gift-endpoint locked" id="giftEnd">
            üéÅ
        </div>
    </div>
</div>

<!-- Puzzle Modal -->
<div class="puzzle-modal" id="puzzleModal">
    <div class="puzzle-title" id="puzzleTitle"></div>
    <div class="puzzle-content" id="puzzleContent"></div>
    <input type="text" class="puzzle-input" id="puzzleInput" placeholder="Enter your answer...">
    <div class="hint-text" id="hintText"></div>
    <div class="puzzle-buttons">
        <button class="puzzle-btn submit-btn" id="submitBtn">Submit</button>
        <button class="puzzle-btn close-btn" id="closeBtn">Close</button>
    </div>
    <div class="feedback-message" id="feedbackMessage"></div>
</div>
            <div class="instruction-text" id="instructionText">
    <span class="emoji">üéÑ</span> Welcome to your Christmas Adventure <span class="emoji">üéÑ</span>
    <br>
    Solve the puzzles to reach your gift at the end of the snowy path
</div>
            <div class="scene-3d">
                <div class="gift-wrapper" id="giftWrapper">
                    <div class="bow" id="bow">
                        <div class="bow-loop bow-loop-left"></div>
                        <div class="bow-loop bow-loop-right"></div>
                        <div class="bow-center"></div>
                        <div class="bow-tails">
                            <div class="bow-tail bow-tail-left"></div>
                            <div class="bow-tail bow-tail-right"></div>
                        </div>
                    </div>
                    
                    <div class="ribbon-vertical" id="ribbonV"></div>
                    <div class="ribbon-horizontal" id="ribbonH"></div>
                    
                    <div class="gift-lid">
                        <div class="gift-lid-top"></div>
                    </div>
                    
                    <div class="gift-box-base"></div>
                    
                    <div class="gift-content">
                        <div class="gift-card">
                            <div class="spa-logo">KOENA</div>
                            <div class="spa-tagline">SPA & WELLNESS</div>
                            <div class="spa-icon">üåø ‚ú® üíÜ‚Äç‚ôÄÔ∏è</div>
                            <div class="christmas-message">Merry Christmas! üéÑ</div>
                        </div>
                    </div>
                    
                    <div class="drag-hint">üëÜ Drag the bow down</div>
                </div>
            </div>

            <div class="final-message">A gift of relaxation and rejuvenation awaits you ‚ú®</div>
        </div>

        <script>
            // Create snowflakes
            const snowContainer = document.getElementById('snowflakes');
            for (let i = 0; i < 60; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
                snowflake.style.opacity = Math.random() * 0.5 + 0.3;
                snowContainer.appendChild(snowflake);
            }

            // Create bokeh lights
            const bokehContainer = document.getElementById('bokeh');
            for (let i = 0; i < 25; i++) {
                const light = document.createElement('div');
                light.className = 'bokeh-light';
                const size = Math.random() * 120 + 60;
                light.style.width = size + 'px';
                light.style.height = size + 'px';
                light.style.left = Math.random() * 100 + '%';
                light.style.top = Math.random() * 100 + '%';
                light.style.animationDelay = Math.random() * 3 + 's';
                light.style.animationDuration = (Math.random() * 4 + 5) + 's';
                bokehContainer.appendChild(light);
            }

            // Bow dragging logic
            const bow = document.getElementById('bow');
            const ribbonV = document.getElementById('ribbonV');
            const ribbonH = document.getElementById('ribbonH');
            const giftWrapper = document.getElementById('giftWrapper');
            const instructionText = document.getElementById('instructionText');

            let isDragging = false;
            let startY = 0;
            let dragDistance = 0;
            const dragThreshold = 120;
            let hasOpened = false;

            function createParticles(x, y) {
                for (let i = 0; i < 15; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = x + (Math.random() - 0.5) * 50 + 'px';
                    particle.style.top = y + (Math.random() - 0.5) * 50 + 'px';
                    particle.style.animationDelay = (Math.random() * 0.3) + 's';
                    document.body.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 2000);
                }
            }

            function handleStart(e) {
                if (hasOpened) return;
                isDragging = true;
                startY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
                bow.style.cursor = 'grabbing';
            }

            function handleMove(e) {
                if (!isDragging || hasOpened) return;
                
                e.preventDefault();
                const currentY = e.type.includes('mouse') ? e.clientY : e.touches[0].clientY;
                dragDistance = Math.max(0, currentY - startY);
                
                const bowProgress = Math.min(1, dragDistance / dragThreshold);
                
                // Move and rotate bow naturally
                bow.style.transform = `translateX(-50%) translateY(${dragDistance}px) rotate(${dragDistance * 0.8}deg) scale(${1 - bowProgress * 0.3})`;
                
                // Fade ribbons
                const opacity = Math.max(0, 1 - (dragDistance / dragThreshold));
                ribbonV.style.opacity = opacity;
                ribbonH.style.opacity = opacity;
                ribbonV.style.transform = `translateX(-50%) scaleY(${1 - bowProgress * 0.5})`;
                
                // Create particles during drag
                if (dragDistance > 20 && Math.random() > 0.85) {
                    const rect = bow.getBoundingClientRect();
                    createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
                }
                
                if (dragDistance > dragThreshold) {
                    openGift();
                }
            }

            function handleEnd() {
                if (!isDragging || hasOpened) return;
                
                isDragging = false;
                bow.style.cursor = 'grab';
                
                if (dragDistance < dragThreshold) {
                    // Bounce back
                    bow.style.transition = 'transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                    bow.style.transform = 'translateX(-50%)';
                    ribbonV.style.opacity = 1;
                    ribbonH.style.opacity = 1;
                    ribbonV.style.transform = 'translateX(-50%)';
                    
                    setTimeout(() => {
                        bow.style.transition = 'transform 0.2s ease';
                    }, 500);
                }
            }

            function openGift() {
                if (hasOpened) return;
                hasOpened = true;
                isDragging = false;
                
                // Create burst of particles
                const rect = bow.getBoundingClientRect();
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
                    }, i * 30);
                }
                
                // Open the gift
                giftWrapper.classList.add('opened');
                
                // Fade instruction text
                instructionText.style.transition = 'opacity 0.8s ease';
                instructionText.style.opacity = '0';
            }

            // Touch events
            bow.addEventListener('touchstart', handleStart, { passive: false });
            bow.addEventListener('touchmove', handleMove, { passive: false });
            bow.addEventListener('touchend', handleEnd);

            // Mouse events
            bow.addEventListener('mousedown', handleStart);
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('mouseup', handleEnd);
            // ======== ESCAPE ROOM LOGIC ========
const escapeRoom = document.getElementById('escapeRoom');
const puzzleModal = document.getElementById('puzzleModal');
const puzzleTitle = document.getElementById('puzzleTitle');
const puzzleContent = document.getElementById('puzzleContent');
const puzzleInput = document.getElementById('puzzleInput');
const hintText = document.getElementById('hintText');
const submitBtn = document.getElementById('submitBtn');
const closeBtn = document.getElementById('closeBtn');
const feedbackMessage = document.getElementById('feedbackMessage');
const progressBar = document.getElementById('progressBar');
const sceneContainer = document.querySelector('.scene-3d');
const giftEnd = document.getElementById('giftEnd');

let currentPuzzle = null;
let solvedPuzzles = 0;

// Puzzle definitions
const puzzles = {
    1: {
        title: "Puzzle 1: The Hungry One ",
        content: "Who is always hungry, loves walks, and never stops asking for treats?\n\nHint: He has four legs and a wagging tail!",
        answer: "charlie",
        hint: "üí° The furry friend of the house!",
        emoji: "‚úÖ"
    },
    2: {
        title: "üá≤üá¶ Puzzle 2: Say Thank You üá≤üá¶",
        content: "In Darija (Moroccan Arabic), how do you say 'Thank You'?\n\nHint: It sounds like 'sugar-ran'!",
        answer: "choukran",
        hint: "üí° no hints you should know this lol",
        emoji: "‚úÖ"
    },
    3: {
    title: "üé© Puzzle 3: The Magic Number üé©",
    content: "Follow these steps with ANY number from 1 to 100:\n\n1: Choose your number\n2: Add 10\n3: Multiply by 2\n4: Subtract twice your original number\n5: Subtract 7\n\n‚ú® What's your final result?",
    answer: "13",
    hint: "üí° Try it with any number... it's magic! ü™Ñ",
    emoji: "‚úÖ"
},
    4: {
        title: "üòÑ Puzzle 4: A Funny Riddle üòÑ",
        content: "What has keys but can't open locks, has space but no room, and you can enter but can't go inside?\n\nHint: You're probably using one right now!",
        answer: "keyboard",
        hint: "üí° Type, type, type... ‚å®Ô∏è",
        emoji: "‚úÖ"
    }
};

// Setup checkpoints
document.querySelectorAll('.checkpoint[data-puzzle]').forEach(checkpoint => {
    checkpoint.addEventListener('click', () => {
        const puzzleNum = parseInt(checkpoint.dataset.puzzle);
        if (!checkpoint.classList.contains('locked')) {
            openPuzzle(puzzleNum);
        }
    });
});

function openPuzzle(puzzleNum) {
    currentPuzzle = puzzleNum;
    const puzzle = puzzles[puzzleNum];
    
    puzzleTitle.textContent = puzzle.title;
    puzzleContent.textContent = puzzle.content;
    hintText.textContent = puzzle.hint;
    puzzleInput.value = '';
    feedbackMessage.textContent = '';
    
    puzzleModal.classList.add('active');
    puzzleInput.focus();
}

function closePuzzle() {
    puzzleModal.classList.remove('active');
    currentPuzzle = null;
}

function checkAnswer() {
    const userAnswer = puzzleInput.value.trim().toLowerCase();
    const correctAnswer = puzzles[currentPuzzle].answer.toLowerCase();
    
    if (userAnswer === correctAnswer) {
        feedbackMessage.textContent = 'üéâ Correct! The path is now open!';
        feedbackMessage.className = 'feedback-message correct';
        
        setTimeout(() => {
            const checkpoint = document.getElementById(`checkpoint${currentPuzzle}`);
            checkpoint.classList.remove('unlocked');
            checkpoint.classList.add('completed');
            checkpoint.textContent = puzzles[currentPuzzle].emoji;
            
            solvedPuzzles++;
            progressBar.textContent = `Puzzles Solved: ${solvedPuzzles}/4`;
            
            // Unlock next checkpoint
            if (currentPuzzle < 4) {
                const nextCheckpoint = document.getElementById(`checkpoint${currentPuzzle + 1}`);
                nextCheckpoint.classList.remove('locked');
                nextCheckpoint.classList.add('unlocked');
            } else {
                // All puzzles solved - unlock gift
                giftEnd.classList.remove('locked');
                giftEnd.classList.add('unlocked');
            }
            
            closePuzzle();
        }, 1500);
    } else {
        feedbackMessage.textContent = '‚ùå Not quite right. Try again!';
        feedbackMessage.className = 'feedback-message incorrect';
        puzzleInput.value = '';
    }
}

// Gift endpoint click - transition to gift opening
giftEnd.addEventListener('click', () => {
    if (giftEnd.classList.contains('unlocked')) {
        // Hide escape room
        escapeRoom.style.display = 'none';
        
        // Show gift scene
        sceneContainer.classList.add('visible');
        sceneContainer.style.display = 'block';
        
        // Update instruction text
        instructionText.innerHTML = '<span class="emoji">üéÑ</span> You made it! Now drag the bow down to reveal your surprise <span class="emoji">üéÑ</span>';
        instructionText.style.opacity = '1';
        instructionText.style.display = 'block';
    }
});

// Event listeners
submitBtn.addEventListener('click', checkAnswer);
closeBtn.addEventListener('click', closePuzzle);
puzzleInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        checkAnswer();
    }
});
        </script>
    </body>
    </html>
